#!/usr/bin/env bash

# Set the directory where the backgrounds are stored
BACKGROUND_DIR="$HOME/.config/bspwm/backgrounds"

# Get the list of backgrounds
BACKGROUND_LIST=("$BACKGROUND_DIR"/*)
echo "Background list: ${BACKGROUND_LIST[@]}"

config_line=$(grep -oP "(?<=\').*(?=\')" ~/.fehbg)

# Extract the wallpaper filename and extension using basename
wallpaper=$(basename $config_line)

# Print the wallpaper filename and extension
echo $wallpaper


# Print the wallpaper filename and extension
echo "Current wallpaper : $wallpaper"
CURRENT_BACKGROUND=$HOME/.config/bspwm/backgrounds/$wallpaper
echo "Current background: $CURRENT_BACKGROUND"

# Find the index of the current background in the list
CURRENT_INDEX=0
for i in "${!BACKGROUND_LIST[@]}"; do
    echo "Comparing ${BACKGROUND_LIST[$i]} with $CURRENT_BACKGROUND"
    if [[ "${BACKGROUND_LIST[$i]}" == "${CURRENT_BACKGROUND}" ]]; then
        CURRENT_INDEX=$i
        echo "Current index: $CURRENT_INDEX"
        break
    fi
done

# Calculate the index of the next background
NEXT_INDEX=$(( (CURRENT_INDEX + 1) % ${#BACKGROUND_LIST[@]} ))
echo "Next index: $NEXT_INDEX"

# Get the path of the next background
NEXT_BACKGROUND="${BACKGROUND_LIST[$NEXT_INDEX]}"

# Set the background to the next background
feh --bg-scale $NEXT_BACKGROUND &

notify-send -i $NEXT_BACKGROUND "Background changed" "$(basename $NEXT_BACKGROUND)"
